pipeline {
    agent any

    environment {
        // Define environment variables if needed
        KUBECONFIG = '/home/jenkins/.kube/config'
    }

    stages {
        stage('Setup Minikube') {
            steps {
                script {
                    // Start Minikube
                    sh 'minikube start'
                    
                    // Set kubectl context to minikube
                    sh 'kubectl config use-context minikube'
                }
            }
        }

        stage('Deploy Application') {
            steps {
                script {
                    // Deploy your application to Minikube
                    sh 'kubectl apply -f path/to/your/kubernetes/config.yml'
                }
            }
        }

        stage('Run Tests') {
            steps {
                script {
                    // Run your tests
                    sh 'kubectl exec -it <your-pod-name> -- <your-test-command>'
                }
            }
        }

        stage('Teardown Minikube') {
            steps {
                script {
                    // Stop Minikube
                    sh 'minikube stop'
                }
            }
        }
    }

    post {
        always {
            // Clean up resources
            script {
                sh 'kubectl delete -f path/to/your/kubernetes/config.yml'
                sh 'minikube delete'
            }
        }
    }
}
